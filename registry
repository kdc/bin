#!/usr/bin/env python3

import requests
import json
import sys
from base64 import b64encode


def list_registry_contents(registry_url, auth):
    print("\nRegistry Contents:")
    print("=================")

    try:
        response = requests.get(f"{registry_url}/v2/_catalog", auth=auth, timeout=10)
        response.raise_for_status()
        catalog = response.json()
    except requests.exceptions.RequestException as e:
        print(f"Error connecting to registry: {e}", file=sys.stderr)
        sys.exit(1)

    for repo in catalog.get('repositories', []):
        try:
            response = requests.get(f"{registry_url}/v2/{repo}/tags/list", auth=auth, timeout=10)
            response.raise_for_status()
            tags = response.json()
            print(f"\nRepository: {repo}")
            print("Tags:", tags.get('tags', []))
        except requests.exceptions.RequestException as e:
            print(f"Error fetching tags for {repo}: {e}", file=sys.stderr)


def main():
    # Configuration
    REGISTRY_URL = ""
    USERNAME = ""
    PASSWORD = ""

    if not REGISTRY_URL:
        print("Error: REGISTRY_URL not configured. Please edit this script.", file=sys.stderr)
        sys.exit(1)

    AUTH = (USERNAME, PASSWORD) if USERNAME and PASSWORD else None

    list_registry_contents(REGISTRY_URL, AUTH)

if __name__ == "__main__":
    main()
