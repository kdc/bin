#!/usr/bin/perl

use strict;
use warnings;

my @topsum = `top -n 1 -b`;
my %cumulativemem;
my $inlist = 0;

foreach my $line (@topsum)
{
    if ($inlist == 1)
    {
        my @curline = split(/\s+/,$line);
        $cumulativemem{$curline[-1]}[0] += $curline[-3];
        ++$cumulativemem{$curline[-1]}[1];
    }
    $inlist = 1 if ($line =~ /^\s+PID/);
}

print "\n\tMem%\tCmd [num instances]\n\n";

my $count = 0;
foreach (sort {$cumulativemem{$b}[0] <=> $cumulativemem{$a}[0]} keys %cumulativemem)
{
    print "\t$cumulativemem{$_}[0]\t$_ \[$cumulativemem{$_}[1]\]\n" if ($cumulativemem{$_}[0] > 0);
    ++$count;
    if ($count == 25) {print "\n"; last}
}
